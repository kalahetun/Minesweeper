# ============================================================================
# 概率故障注入策略 (带服务选择器)
# ============================================================================
#
# 功能：按百分比概率注入故障
# 场景：模拟间歇性故障，测试重试机制和容错能力
#
# 关键字段说明：
#   - selector: 指定策略应用的目标服务和命名空间
#   - percentage: 故障触发概率 (0-100)，这是核心配置项
#
# 使用方法：
#   hfi-cli policy apply -f basic/percentage-policy.yaml
#
# ============================================================================

metadata:
  name: "percentage-policy"

spec:
  # 服务选择器 - 指定策略应用范围
  selector:
    service: frontend           # 目标服务名
    namespace: demo             # 目标命名空间

  rules:
    - match:
        method:
          exact: "GET"          # 仅匹配 GET 请求
        path:
          exact: "/"            # 仅匹配根路径
      
      fault:
        percentage: 50          # 50% 概率触发
        # 概率设置建议：
        #   10%  - 轻微干扰，测试基础容错
        #   30%  - 中等故障率，测试重试逻辑
        #   50%  - 高故障率，压力测试
        #   100% - 完全故障，测试降级策略
        
        delay:
          fixed_delay: "500ms"  # 延迟 500ms
        
        # 也可以使用 abort 代替 delay：
        # abort:
        #   httpStatus: 503
