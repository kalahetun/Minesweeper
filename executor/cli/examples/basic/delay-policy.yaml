# ============================================================================
# Delay 故障注入策略 (带服务选择器)
# ============================================================================
#
# 功能：延迟请求响应指定时间
# 场景：测试服务对慢响应的超时处理、重试策略、用户体验影响
#
# 关键字段说明：
#   - selector: 指定策略应用的目标服务和命名空间
#   - percentage: 故障触发概率 (0-100)
#   - fixed_delay: 延迟时间，支持 ms/s/m 单位
#
# 使用方法：
#   hfi-cli policy apply -f basic/delay-policy.yaml
#
# ============================================================================

metadata:
  name: "delay-policy"

spec:
  # 服务选择器 - 指定策略应用范围
  selector:
    service: frontend           # 目标服务名
    namespace: demo             # 目标命名空间

  rules:
    - match:
        method:
          exact: "GET"          # 仅匹配 GET 请求
        path:
          exact: "/"            # 仅匹配根路径
      
      fault:
        percentage: 100         # 100% 触发
        delay:
          fixed_delay_ms: 1000  # 延迟 1 秒
          # 时间单位（毫秒）：
          #   100  - 网络抖动
          #   500  - 慢响应
          #   2000 - 接近超时
          #   5000 - 超时测试
